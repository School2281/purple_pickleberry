# ============================================
# INTENTIONALLY VULNERABLE CONFIG
# DO NOT USE IN PRODUCTION
# ============================================

# NO RATE LIMITING ZONES - Commented out or missing!
# limit_req_zone $binary_remote_addr zone=fractal:10m rate=5r/m;  ← MISSING
# limit_conn_zone $binary_remote_addr zone=addr:10m;             ← MISSING

server {
    listen 80;
    server_name _;
    
    # ============================================
    # DANGEROUS TIMEOUTS - Keep connections open FOREVER
    # ============================================
    
    # Client timeouts - EXTREMELY LONG (slowloris heaven)
    client_body_timeout 3600s;      # 1 HOUR to send data
    client_header_timeout 3600s;     # 1 HOUR to send headers
    keepalive_timeout 3600s;         # Keep connection open for 1 hour
    send_timeout 3600s;              # 1 HOUR to send response
    
    # ============================================
    # DANGEROUS REQUEST SIZE - Allow massive payloads
    # ============================================
    
    client_max_body_size 100M;       # Allow 100MB uploads (memory exhaustion)
    client_body_buffer_size 100M;     # Buffer 100MB in memory
    
    # ============================================
    # NO BUFFER LIMITS - Let attackers fill memory
    # ============================================
    
    client_body_in_file_only off;
    client_body_temp_path /tmp;       # Write temp files to /tmp (can fill disk)
    
    # ============================================
    # STATIC FILES - No protections
    # ============================================
    
    location / {
        root /var/www/html;
        try_files $uri $uri/ =404;
        
        # NO CACHING - Regenerate everything every time
        expires off;
        add_header Cache-Control "no-store";
        
        # ALLOW ALL METHODS
        limit_except GET {
            deny all;  # Actually this is good, but we want vulnerable!
        }
    }
    
    # ============================================
    # FRACTAL ENDPOINT - COMPLETELY UNPROTECTED
    # ============================================
    
    location /fractal {
        # NO RATE LIMITS - Attackers can spam endlessly
        # limit_req zone=fractal burst=3;  ← MISSING
        # limit_conn addr 2;                 ← MISSING
        
        # NO PROXY BUFFERS - Can exhaust memory
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 4 4k;      # Just 4 small buffers
        proxy_busy_buffers_size 8k;
        
        # DANGEROUS TIMEOUTS - Keep connections open forever
        proxy_connect_timeout 300s;     # 5 minutes to connect
        proxy_read_timeout 300s;        # 5 minutes to read
        proxy_send_timeout 300s;        # 5 minutes to send
        
        # PASS TO FLASK - No protection
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # ALLOW ANY REQUEST SIZE
        client_max_body_size 0;          # Unlimited request size
    }

    location /viewer {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # Shorter timeouts for viewer (it's just HTML)
        proxy_connect_timeout 5s;
        proxy_read_timeout 10s;
        proxy_send_timeout 10s;
    }
    
    # Add this for light test
    location /light {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        proxy_connect_timeout 5s;
        proxy_read_timeout 30s;
        proxy_send_timeout 10s;
    }

    # ============================================
    # STATUS ENDPOINT - ALSO UNPROTECTED
    # ============================================
    
    location /status {
        proxy_pass http://127.0.0.1:5000;
        proxy_read_timeout 300s;         # 5 minutes timeout
        
        # Can be hammered repeatedly
    }
    
    # ============================================
    # ADDITIONAL VULNERABILITIES
    # ============================================
    
    
    # No limits on connections
    # No limits on requests
    
    # Expose server version
    server_tokens off;  # Actually this hides version - vulnerable would be "on"
    # server_tokens on;  ← This would expose version
    
    # No security headers
    # add_header X-Frame-Options "SAMEORIGIN" always;  ← MISSING
    # add_header X-Content-Type-Options "nosniff" always;  ← MISSING
}
